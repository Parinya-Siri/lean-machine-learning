import analysis.normed_space.multilinear
noncomputable theory
open set fin
open_locale topological_space
variables {ğ•œ ğ•œ' E F G : Type*}
section
variables [comm_ring ğ•œ]
  [add_comm_group E] [module ğ•œ E] [topological_space E] [topological_add_group E]
  [has_continuous_const_smul ğ•œ E]
  [add_comm_group F] [module ğ•œ F] [topological_space F] [topological_add_group F]
  [has_continuous_const_smul ğ•œ F]
  [add_comm_group G] [module ğ•œ G] [topological_space G] [topological_add_group G]
  [has_continuous_const_smul ğ•œ G]
@[derive add_comm_group, nolint unused_arguments]
def formal_multilinear_series (ğ•œ : Type*) (E : Type*) (F : Type*)
  [ring ğ•œ]
  [add_comm_group E] [module ğ•œ E] [topological_space E] [topological_add_group E]
    [has_continuous_const_smul ğ•œ E]
  [add_comm_group F] [module ğ•œ F] [topological_space F] [topological_add_group F]
    [has_continuous_const_smul ğ•œ F] :=
Î  (n : â„•), (E [Ã—n]â†’L[ğ•œ] F)
instance : inhabited (formal_multilinear_series ğ•œ E F) := âŸ¨0âŸ©
section module
instance : module ğ•œ (formal_multilinear_series ğ•œ E F) :=
begin
  letI : Î  n, module ğ•œ (continuous_multilinear_map ğ•œ (Î» (i : fin n), E) F) :=
    Î» n, by apply_instance,
  refine pi.module _ _ _,
end
end module
namespace formal_multilinear_series
def remove_zero (p : formal_multilinear_series ğ•œ E F) : formal_multilinear_series ğ•œ E F
| 0       := 0
| (n + 1) := p (n + 1)
@[simp] lemma remove_zero_coeff_zero (p : formal_multilinear_series ğ•œ E F) :
  p.remove_zero 0 = 0 := rfl
@[simp] lemma remove_zero_coeff_succ (p : formal_multilinear_series ğ•œ E F) (n : â„•) :
  p.remove_zero (n+1) = p (n+1) := rfl
lemma remove_zero_of_pos (p : formal_multilinear_series ğ•œ E F) {n : â„•} (h : 0 < n) :
  p.remove_zero n = p n :=
by { rw â† nat.succ_pred_eq_of_pos h, refl }
lemma congr (p : formal_multilinear_series ğ•œ E F) {m n : â„•} {v : fin m â†’ E} {w : fin n â†’ E}
  (h1 : m = n) (h2 : âˆ€ (i : â„•) (him : i < m) (hin : i < n), v âŸ¨i, himâŸ© = w âŸ¨i, hinâŸ©) :
  p m v = p n w :=
by { cases h1, congr' with âŸ¨i, hiâŸ©, exact h2 i hi hi }
def comp_continuous_linear_map (p : formal_multilinear_series ğ•œ F G) (u : E â†’L[ğ•œ] F) :
  formal_multilinear_series ğ•œ E G :=
Î» n, (p n).comp_continuous_linear_map (Î» (i : fin n), u)
@[simp] lemma comp_continuous_linear_map_apply
  (p : formal_multilinear_series ğ•œ F G) (u : E â†’L[ğ•œ] F) (n : â„•) (v : fin n â†’ E) :
  (p.comp_continuous_linear_map u) n v = p n (u âˆ˜ v) := rfl
variables (ğ•œ) [comm_ring ğ•œ'] [has_smul ğ•œ ğ•œ']
variables [module ğ•œ' E] [has_continuous_const_smul ğ•œ' E] [is_scalar_tower ğ•œ ğ•œ' E]
variables [module ğ•œ' F] [has_continuous_const_smul ğ•œ' F] [is_scalar_tower ğ•œ ğ•œ' F]
@[simp] protected def restrict_scalars (p : formal_multilinear_series ğ•œ' E F) :
  formal_multilinear_series ğ•œ E F :=
Î» n, (p n).restrict_scalars ğ•œ
end formal_multilinear_series
end
namespace formal_multilinear_series
variables [nondiscrete_normed_field ğ•œ]
  [normed_group E] [normed_space ğ•œ E]
  [normed_group F] [normed_space ğ•œ F]
  [normed_group G] [normed_space ğ•œ G]
variables (p : formal_multilinear_series ğ•œ E F)
def shift : formal_multilinear_series ğ•œ E (E â†’L[ğ•œ] F) :=
Î»n, (p n.succ).curry_right
def unshift (q : formal_multilinear_series ğ•œ E (E â†’L[ğ•œ] F)) (z : F) :
  formal_multilinear_series ğ•œ E F
| 0       := (continuous_multilinear_curry_fin0 ğ•œ E F).symm z
| (n + 1) := continuous_multilinear_curry_right_equiv' ğ•œ n E F (q n)
end formal_multilinear_series
namespace continuous_linear_map
variables [comm_ring ğ•œ]
  [add_comm_group E] [module ğ•œ E] [topological_space E] [topological_add_group E]
  [has_continuous_const_smul ğ•œ E]
  [add_comm_group F] [module ğ•œ F] [topological_space F] [topological_add_group F]
  [has_continuous_const_smul ğ•œ F]
  [add_comm_group G] [module ğ•œ G] [topological_space G] [topological_add_group G]
  [has_continuous_const_smul ğ•œ G]
def comp_formal_multilinear_series (f : F â†’L[ğ•œ] G) (p : formal_multilinear_series ğ•œ E F) :
  formal_multilinear_series ğ•œ E G :=
Î» n, f.comp_continuous_multilinear_map (p n)
@[simp] lemma comp_formal_multilinear_series_apply
  (f : F â†’L[ğ•œ] G) (p : formal_multilinear_series ğ•œ E F) (n : â„•) :
  (f.comp_formal_multilinear_series p) n = f.comp_continuous_multilinear_map (p n) :=
rfl
lemma comp_formal_multilinear_series_apply'
  (f : F â†’L[ğ•œ] G) (p : formal_multilinear_series ğ•œ E F) (n : â„•) (v : fin n â†’ E) :
  (f.comp_formal_multilinear_series p) n v = f (p n v) :=
rfl
end continuous_linear_map
