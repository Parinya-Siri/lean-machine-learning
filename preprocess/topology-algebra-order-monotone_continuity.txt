import topology.algebra.order.basic
import topology.algebra.order.left_right
open set filter
open_locale topological_space
section linear_order
variables {Î± Î² : Type*} [linear_order Î±] [topological_space Î±] [order_topology Î±]
variables [linear_order Î²] [topological_space Î²] [order_topology Î²]
lemma strict_mono_on.continuous_at_right_of_exists_between {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¥] a)
  (hfs : âˆ€ b > f a, âˆƒ c âˆˆ s, f c âˆˆ Ioc (f a) b) :
  continuous_within_at f (Ici a) a :=
begin
  have ha : a âˆˆ Ici a := left_mem_Ici,
  have has : a âˆˆ s := mem_of_mem_nhds_within ha hs,
  refine tendsto_order.2 âŸ¨Î» b hb, _, Î» b hb, _âŸ©,
  { filter_upwards [hs, self_mem_nhds_within] with _ hxs hxa
      using hb.trans_le ((h_mono.le_iff_le has hxs).2 hxa) },
  { rcases hfs b hb with âŸ¨c, hcs, hac, hcbâŸ©,
    rw [h_mono.lt_iff_lt has hcs] at hac,
    filter_upwards [hs, Ico_mem_nhds_within_Ici (left_mem_Ico.2 hac)],
    rintros x hx âŸ¨hax, hxcâŸ©,
    exact ((h_mono.lt_iff_lt hx hcs).2 hxc).trans_le hcb }
end
lemma continuous_at_right_of_monotone_on_of_exists_between {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (h_mono : monotone_on f s) (hs : s âˆˆ ğ“[â‰¥] a)
  (hfs : âˆ€ b > f a, âˆƒ c âˆˆ s, f c âˆˆ Ioo (f a) b) :
  continuous_within_at f (Ici a) a :=
begin
  have ha : a âˆˆ Ici a := left_mem_Ici,
  have has : a âˆˆ s := mem_of_mem_nhds_within ha hs,
  refine tendsto_order.2 âŸ¨Î» b hb, _, Î» b hb, _âŸ©,
  { filter_upwards [hs, self_mem_nhds_within] with _ hxs hxa
      using hb.trans_le (h_mono has hxs hxa) },
  { rcases hfs b hb with âŸ¨c, hcs, hac, hcbâŸ©,
    have : a < c, from not_le.1 (Î» h, hac.not_le $ h_mono hcs has h),
    filter_upwards [hs, Ico_mem_nhds_within_Ici (left_mem_Ico.2 this)],
    rintros x hx âŸ¨hax, hxcâŸ©,
    exact (h_mono hx hcs hxc.le).trans_lt hcb }
end
lemma continuous_at_right_of_monotone_on_of_closure_image_mem_nhds_within [densely_ordered Î²]
  {f : Î± â†’ Î²} {s : set Î±} {a : Î±} (h_mono : monotone_on f s)
  (hs : s âˆˆ ğ“[â‰¥] a) (hfs : closure (f '' s) âˆˆ ğ“[â‰¥] (f a)) :
  continuous_within_at f (Ici a) a :=
begin
  refine continuous_at_right_of_monotone_on_of_exists_between h_mono hs (Î» b hb, _),
  rcases (mem_nhds_within_Ici_iff_exists_mem_Ioc_Ico_subset hb).1 hfs with âŸ¨b', âŸ¨hab', hbb'âŸ©, hb'âŸ©,
  rcases exists_between hab' with âŸ¨c', hc'âŸ©,
  rcases mem_closure_iff.1 (hb' âŸ¨hc'.1.le, hc'.2âŸ©) (Ioo (f a) b') is_open_Ioo hc'
    with âŸ¨_, hc, âŸ¨c, hcs, rflâŸ©âŸ©,
  exact âŸ¨c, hcs, hc.1, hc.2.trans_le hbb'âŸ©
end
lemma continuous_at_right_of_monotone_on_of_image_mem_nhds_within [densely_ordered Î²] {f : Î± â†’ Î²}
  {s : set Î±} {a : Î±} (h_mono : monotone_on f s) (hs : s âˆˆ ğ“[â‰¥] a)
  (hfs : f '' s âˆˆ ğ“[â‰¥] (f a)) :
  continuous_within_at f (Ici a) a :=
continuous_at_right_of_monotone_on_of_closure_image_mem_nhds_within h_mono hs $
  mem_of_superset hfs subset_closure
lemma strict_mono_on.continuous_at_right_of_closure_image_mem_nhds_within [densely_ordered Î²]
  {f : Î± â†’ Î²} {s : set Î±} {a : Î±} (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¥] a)
  (hfs : closure (f '' s) âˆˆ ğ“[â‰¥] (f a)) :
  continuous_within_at f (Ici a) a :=
continuous_at_right_of_monotone_on_of_closure_image_mem_nhds_within
  (Î» x hx y hy, (h_mono.le_iff_le hx hy).2) hs hfs
lemma strict_mono_on.continuous_at_right_of_image_mem_nhds_within [densely_ordered Î²]
  {f : Î± â†’ Î²} {s : set Î±} {a : Î±} (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¥] a)
  (hfs : f '' s âˆˆ ğ“[â‰¥] (f a)) :
  continuous_within_at f (Ici a) a :=
h_mono.continuous_at_right_of_closure_image_mem_nhds_within hs
  (mem_of_superset hfs subset_closure)
lemma strict_mono_on.continuous_at_right_of_surj_on {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¥] a) (hfs : surj_on f s (Ioi (f a))) :
  continuous_within_at f (Ici a) a :=
h_mono.continuous_at_right_of_exists_between hs $ Î» b hb, let âŸ¨c, hcs, hcbâŸ© := hfs hb in
âŸ¨c, hcs, hcb.symm â–¸ hb, hcb.leâŸ©
lemma strict_mono_on.continuous_at_left_of_exists_between {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¤] a)
  (hfs : âˆ€ b < f a, âˆƒ c âˆˆ s, f c âˆˆ Ico b (f a)) :
  continuous_within_at f (Iic a) a :=
h_mono.dual.continuous_at_right_of_exists_between hs $
  Î» b hb, let âŸ¨c, hcs, hcb, hcaâŸ© := hfs b hb in âŸ¨c, hcs, hca, hcbâŸ©
lemma continuous_at_left_of_monotone_on_of_exists_between {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (hf : monotone_on f s) (hs : s âˆˆ ğ“[â‰¤] a)
  (hfs : âˆ€ b < f a, âˆƒ c âˆˆ s, f c âˆˆ Ioo b (f a)) :
  continuous_within_at f (Iic a) a :=
@continuous_at_right_of_monotone_on_of_exists_between Î±áµ’áµˆ Î²áµ’áµˆ _ _ _ _ _ _ f s a hf.dual hs $
  Î» b hb, let âŸ¨c, hcs, hcb, hcaâŸ© := hfs b hb in âŸ¨c, hcs, hca, hcbâŸ©
lemma continuous_at_left_of_monotone_on_of_closure_image_mem_nhds_within [densely_ordered Î²]
  {f : Î± â†’ Î²} {s : set Î±} {a : Î±} (hf : monotone_on f s)
  (hs : s âˆˆ ğ“[â‰¤] a) (hfs : closure (f '' s) âˆˆ ğ“[â‰¤] (f a)) :
  continuous_within_at f (Iic a) a :=
@continuous_at_right_of_monotone_on_of_closure_image_mem_nhds_within Î±áµ’áµˆ Î²áµ’áµˆ _ _ _ _ _ _ _
  f s a hf.dual hs hfs
lemma continuous_at_left_of_monotone_on_of_image_mem_nhds_within [densely_ordered Î²]
  {f : Î± â†’ Î²} {s : set Î±} {a : Î±} (h_mono : monotone_on f s)
  (hs : s âˆˆ ğ“[â‰¤] a) (hfs : f '' s âˆˆ ğ“[â‰¤] (f a)) :
  continuous_within_at f (Iic a) a :=
continuous_at_left_of_monotone_on_of_closure_image_mem_nhds_within h_mono hs
  (mem_of_superset hfs subset_closure)
lemma strict_mono_on.continuous_at_left_of_closure_image_mem_nhds_within [densely_ordered Î²]
  {f : Î± â†’ Î²} {s : set Î±} {a : Î±} (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¤] a)
  (hfs : closure (f '' s) âˆˆ ğ“[â‰¤] (f a)) :
  continuous_within_at f (Iic a) a :=
h_mono.dual.continuous_at_right_of_closure_image_mem_nhds_within hs hfs
lemma strict_mono_on.continuous_at_left_of_image_mem_nhds_within [densely_ordered Î²]
  {f : Î± â†’ Î²} {s : set Î±} {a : Î±} (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¤] a)
  (hfs : f '' s âˆˆ ğ“[â‰¤] (f a)) :
  continuous_within_at f (Iic a) a :=
h_mono.dual.continuous_at_right_of_image_mem_nhds_within hs hfs
lemma strict_mono_on.continuous_at_left_of_surj_on {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“[â‰¤] a) (hfs : surj_on f s (Iio (f a))) :
  continuous_within_at f (Iic a) a :=
h_mono.dual.continuous_at_right_of_surj_on hs hfs
lemma strict_mono_on.continuous_at_of_exists_between {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“ a)
  (hfs_l : âˆ€ b < f a, âˆƒ c âˆˆ s, f c âˆˆ Ico b (f a)) (hfs_r : âˆ€ b > f a, âˆƒ c âˆˆ s, f c âˆˆ Ioc (f a) b) :
  continuous_at f a :=
continuous_at_iff_continuous_left_right.2
  âŸ¨h_mono.continuous_at_left_of_exists_between (mem_nhds_within_of_mem_nhds hs) hfs_l,
   h_mono.continuous_at_right_of_exists_between (mem_nhds_within_of_mem_nhds hs) hfs_râŸ©
lemma strict_mono_on.continuous_at_of_closure_image_mem_nhds [densely_ordered Î²] {f : Î± â†’ Î²}
  {s : set Î±} {a : Î±} (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“ a)
  (hfs : closure (f '' s) âˆˆ ğ“ (f a)) :
  continuous_at f a :=
continuous_at_iff_continuous_left_right.2
  âŸ¨h_mono.continuous_at_left_of_closure_image_mem_nhds_within (mem_nhds_within_of_mem_nhds hs)
     (mem_nhds_within_of_mem_nhds hfs),
   h_mono.continuous_at_right_of_closure_image_mem_nhds_within (mem_nhds_within_of_mem_nhds hs)
     (mem_nhds_within_of_mem_nhds hfs)âŸ©
lemma strict_mono_on.continuous_at_of_image_mem_nhds [densely_ordered Î²] {f : Î± â†’ Î²}
  {s : set Î±} {a : Î±} (h_mono : strict_mono_on f s) (hs : s âˆˆ ğ“ a) (hfs : f '' s âˆˆ ğ“ (f a)) :
  continuous_at f a :=
h_mono.continuous_at_of_closure_image_mem_nhds hs (mem_of_superset hfs subset_closure)
lemma continuous_at_of_monotone_on_of_exists_between {f : Î± â†’ Î²} {s : set Î±} {a : Î±}
  (h_mono : monotone_on f s) (hs : s âˆˆ ğ“ a)
  (hfs_l : âˆ€ b < f a, âˆƒ c âˆˆ s, f c âˆˆ Ioo b (f a)) (hfs_r : âˆ€ b > f a, âˆƒ c âˆˆ s, f c âˆˆ Ioo (f a) b) :
  continuous_at f a :=
continuous_at_iff_continuous_left_right.2
  âŸ¨continuous_at_left_of_monotone_on_of_exists_between h_mono
     (mem_nhds_within_of_mem_nhds hs) hfs_l,
   continuous_at_right_of_monotone_on_of_exists_between h_mono
     (mem_nhds_within_of_mem_nhds hs) hfs_râŸ©
lemma continuous_at_of_monotone_on_of_closure_image_mem_nhds [densely_ordered Î²] {f : Î± â†’ Î²}
  {s : set Î±} {a : Î±} (h_mono : monotone_on f s) (hs : s âˆˆ ğ“ a)
  (hfs : closure (f '' s) âˆˆ ğ“ (f a)) :
  continuous_at f a :=
continuous_at_iff_continuous_left_right.2
  âŸ¨continuous_at_left_of_monotone_on_of_closure_image_mem_nhds_within h_mono
     (mem_nhds_within_of_mem_nhds hs) (mem_nhds_within_of_mem_nhds hfs),
   continuous_at_right_of_monotone_on_of_closure_image_mem_nhds_within h_mono
     (mem_nhds_within_of_mem_nhds hs) (mem_nhds_within_of_mem_nhds hfs)âŸ©
lemma continuous_at_of_monotone_on_of_image_mem_nhds [densely_ordered Î²] {f : Î± â†’ Î²}
  {s : set Î±} {a : Î±} (h_mono : monotone_on f s) (hs : s âˆˆ ğ“ a)
  (hfs : f '' s âˆˆ ğ“ (f a)) :
  continuous_at f a :=
continuous_at_of_monotone_on_of_closure_image_mem_nhds h_mono hs
  (mem_of_superset hfs subset_closure)
lemma monotone.continuous_of_dense_range [densely_ordered Î²] {f : Î± â†’ Î²}
  (h_mono : monotone f) (h_dense : dense_range f) :
  continuous f :=
continuous_iff_continuous_at.mpr $ Î» a,
  continuous_at_of_monotone_on_of_closure_image_mem_nhds (Î» x hx y hy hxy, h_mono hxy)
    univ_mem $ by simp only [image_univ, h_dense.closure_eq, univ_mem]
lemma monotone.continuous_of_surjective [densely_ordered Î²] {f : Î± â†’ Î²} (h_mono : monotone f)
  (h_surj : function.surjective f) :
  continuous f :=
h_mono.continuous_of_dense_range h_surj.dense_range
end linear_order
namespace order_iso
variables {Î± Î² : Type*} [partial_order Î±] [partial_order Î²] [topological_space Î±]
  [topological_space Î²] [order_topology Î±] [order_topology Î²]
protected lemma continuous (e : Î± â‰ƒo Î²) : continuous e :=
begin
  rw [â€¹order_topology Î²â€º.topology_eq_generate_intervals],
  refine continuous_generated_from (Î» s hs, _),
  rcases hs with âŸ¨a, rfl|rflâŸ©,
  { rw e.preimage_Ioi, apply is_open_lt' },
  { rw e.preimage_Iio, apply is_open_gt' }
end
def to_homeomorph (e : Î± â‰ƒo Î²) : Î± â‰ƒâ‚œ Î² :=
{ continuous_to_fun := e.continuous,
  continuous_inv_fun := e.symm.continuous,
  .. e }
@[simp] lemma coe_to_homeomorph (e : Î± â‰ƒo Î²) : â‡‘e.to_homeomorph = e := rfl
@[simp] lemma coe_to_homeomorph_symm (e : Î± â‰ƒo Î²) : â‡‘e.to_homeomorph.symm = e.symm := rfl
end order_iso
