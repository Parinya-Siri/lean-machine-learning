import topology.algebra.monoid
import algebra.group.pi
import topology.homeomorph
open_locale topological_space filter
open filter function
variables {Œ± Œ≤ G‚ÇÄ : Type*}
section div_const
variables [group_with_zero G‚ÇÄ] [topological_space G‚ÇÄ] [has_continuous_mul G‚ÇÄ]
  {f : Œ± ‚Üí G‚ÇÄ} {s : set Œ±} {l : filter Œ±}
lemma filter.tendsto.div_const {x y : G‚ÇÄ} (hf : tendsto f l (ùìù x)) :
  tendsto (Œªa, f a / y) l (ùìù (x / y)) :=
by simpa only [div_eq_mul_inv] using hf.mul tendsto_const_nhds
variables [topological_space Œ±]
lemma continuous_at.div_const {a : Œ±} (hf : continuous_at f a) {y : G‚ÇÄ} :
  continuous_at (Œª x, f x / y) a :=
by simpa only [div_eq_mul_inv] using hf.mul continuous_at_const
lemma continuous_within_at.div_const {a} (hf : continuous_within_at f s a) {y : G‚ÇÄ} :
  continuous_within_at (Œª x, f x / y) s a :=
hf.div_const
lemma continuous_on.div_const (hf : continuous_on f s) {y : G‚ÇÄ} : continuous_on (Œª x, f x / y) s :=
by simpa only [div_eq_mul_inv] using hf.mul continuous_on_const
@[continuity] lemma continuous.div_const (hf : continuous f) {y : G‚ÇÄ} :
  continuous (Œª x, f x / y) :=
by simpa only [div_eq_mul_inv] using hf.mul continuous_const
end div_const
class has_continuous_inv‚ÇÄ (G‚ÇÄ : Type*) [has_zero G‚ÇÄ] [has_inv G‚ÇÄ] [topological_space G‚ÇÄ] : Prop :=
(continuous_at_inv‚ÇÄ : ‚àÄ ‚¶Éx : G‚ÇÄ‚¶Ñ, x ‚â† 0 ‚Üí continuous_at has_inv.inv x)
export has_continuous_inv‚ÇÄ (continuous_at_inv‚ÇÄ)
section inv‚ÇÄ
variables [has_zero G‚ÇÄ] [has_inv G‚ÇÄ] [topological_space G‚ÇÄ] [has_continuous_inv‚ÇÄ G‚ÇÄ]
  {l : filter Œ±} {f : Œ± ‚Üí G‚ÇÄ} {s : set Œ±} {a : Œ±}
lemma tendsto_inv‚ÇÄ {x : G‚ÇÄ}  (hx : x ‚â† 0) : tendsto has_inv.inv (ùìù x) (ùìù x‚Åª¬π) :=
continuous_at_inv‚ÇÄ hx
lemma continuous_on_inv‚ÇÄ : continuous_on (has_inv.inv : G‚ÇÄ ‚Üí G‚ÇÄ) {0}·∂ú :=
Œª x hx, (continuous_at_inv‚ÇÄ hx).continuous_within_at
lemma filter.tendsto.inv‚ÇÄ {a : G‚ÇÄ} (hf : tendsto f l (ùìù a))
  (ha : a ‚â† 0) :
  tendsto (Œª x, (f x)‚Åª¬π) l (ùìù a‚Åª¬π) :=
(tendsto_inv‚ÇÄ ha).comp hf
variables [topological_space Œ±]
lemma continuous_within_at.inv‚ÇÄ (hf : continuous_within_at f s a) (ha : f a ‚â† 0) :
  continuous_within_at (Œª x, (f x)‚Åª¬π) s a :=
hf.inv‚ÇÄ ha
lemma continuous_at.inv‚ÇÄ (hf : continuous_at f a) (ha : f a ‚â† 0) :
  continuous_at (Œª x, (f x)‚Åª¬π) a :=
hf.inv‚ÇÄ ha
@[continuity] lemma continuous.inv‚ÇÄ (hf : continuous f) (h0 : ‚àÄ x, f x ‚â† 0) :
  continuous (Œª x, (f x)‚Åª¬π) :=
continuous_iff_continuous_at.2 $ Œª x, (hf.tendsto x).inv‚ÇÄ (h0 x)
lemma continuous_on.inv‚ÇÄ (hf : continuous_on f s) (h0 : ‚àÄ x ‚àà s, f x ‚â† 0) :
  continuous_on (Œª x, (f x)‚Åª¬π) s :=
Œª x hx, (hf x hx).inv‚ÇÄ (h0 x hx)
end inv‚ÇÄ
section div
variables [group_with_zero G‚ÇÄ] [topological_space G‚ÇÄ] [has_continuous_inv‚ÇÄ G‚ÇÄ]
  [has_continuous_mul G‚ÇÄ] {f g : Œ± ‚Üí G‚ÇÄ}
lemma filter.tendsto.div {l : filter Œ±} {a b : G‚ÇÄ} (hf : tendsto f l (ùìù a))
  (hg : tendsto g l (ùìù b)) (hy : b ‚â† 0) :
  tendsto (f / g) l (ùìù (a / b)) :=
by simpa only [div_eq_mul_inv] using hf.mul (hg.inv‚ÇÄ hy)
variables [topological_space Œ±] [topological_space Œ≤] {s : set Œ±} {a : Œ±}
lemma continuous_within_at.div (hf : continuous_within_at f s a) (hg : continuous_within_at g s a)
  (h‚ÇÄ : g a ‚â† 0) :
  continuous_within_at (f / g) s a :=
hf.div hg h‚ÇÄ
lemma continuous_on.div (hf : continuous_on f s) (hg : continuous_on g s) (h‚ÇÄ : ‚àÄ x ‚àà s, g x ‚â† 0) :
  continuous_on (f / g) s :=
Œª x hx, (hf x hx).div (hg x hx) (h‚ÇÄ x hx)
lemma continuous_at.div (hf : continuous_at f a) (hg : continuous_at g a) (h‚ÇÄ : g a ‚â† 0) :
  continuous_at (f / g) a :=
hf.div hg h‚ÇÄ
@[continuity] lemma continuous.div (hf : continuous f) (hg : continuous g) (h‚ÇÄ : ‚àÄ x, g x ‚â† 0) :
  continuous (f / g) :=
by simpa only [div_eq_mul_inv] using hf.mul (hg.inv‚ÇÄ h‚ÇÄ)
lemma continuous_on_div : continuous_on (Œª p : G‚ÇÄ √ó G‚ÇÄ, p.1 / p.2) {p | p.2 ‚â† 0} :=
continuous_on_fst.div continuous_on_snd $ Œª _, id
lemma continuous_at.comp_div_cases {f g : Œ± ‚Üí G‚ÇÄ} (h : Œ± ‚Üí G‚ÇÄ ‚Üí Œ≤)
  (hf : continuous_at f a) (hg : continuous_at g a)
  (hh : g a ‚â† 0 ‚Üí continuous_at ‚Üøh (a, f a / g a))
  (h2h : g a = 0 ‚Üí tendsto ‚Üøh (ùìù a √ó·∂† ‚ä§) (ùìù (h a 0))) :
  continuous_at (Œª x, h x (f x / g x)) a :=
begin
  show continuous_at (‚Üøh ‚àò (Œª x, (x, f x / g x))) a,
  by_cases hga : g a = 0,
  { rw [continuous_at], simp_rw [comp_app, hga, div_zero],
    exact (h2h hga).comp (continuous_at_id.prod_mk tendsto_top) },
  { exact continuous_at.comp (hh hga) (continuous_at_id.prod (hf.div hg hga)) }
end
lemma continuous.comp_div_cases {f g : Œ± ‚Üí G‚ÇÄ} (h : Œ± ‚Üí G‚ÇÄ ‚Üí Œ≤)
  (hf : continuous f) (hg : continuous g)
  (hh : ‚àÄ a, g a ‚â† 0 ‚Üí continuous_at ‚Üøh (a, f a / g a))
  (h2h : ‚àÄ a, g a = 0 ‚Üí tendsto ‚Üøh (ùìù a √ó·∂† ‚ä§) (ùìù (h a 0))) :
  continuous (Œª x, h x (f x / g x)) :=
continuous_iff_continuous_at.mpr $
  Œª a, hf.continuous_at.comp_div_cases _ hg.continuous_at (hh a) (h2h a)
end div
namespace homeomorph
variables [topological_space Œ±] [group_with_zero Œ±] [has_continuous_mul Œ±]
protected def mul_left‚ÇÄ (c : Œ±) (hc : c ‚â† 0) : Œ± ‚âÉ‚Çú Œ± :=
{ continuous_to_fun := continuous_mul_left _,
  continuous_inv_fun := continuous_mul_left _,
  .. equiv.mul_left‚ÇÄ c hc }
protected def mul_right‚ÇÄ (c : Œ±) (hc : c ‚â† 0) : Œ± ‚âÉ‚Çú Œ± :=
{ continuous_to_fun := continuous_mul_right _,
  continuous_inv_fun := continuous_mul_right _,
  .. equiv.mul_right‚ÇÄ c hc }
@[simp] lemma coe_mul_left‚ÇÄ (c : Œ±) (hc : c ‚â† 0) : ‚áë(homeomorph.mul_left‚ÇÄ c hc) = (*) c := rfl
@[simp] lemma mul_left‚ÇÄ_symm_apply (c : Œ±) (hc : c ‚â† 0) :
  ((homeomorph.mul_left‚ÇÄ c hc).symm : Œ± ‚Üí Œ±) = (*) c‚Åª¬π := rfl
@[simp] lemma coe_mul_right‚ÇÄ (c : Œ±) (hc : c ‚â† 0) :
  ‚áë(homeomorph.mul_right‚ÇÄ c hc) = Œª x, x * c := rfl
@[simp] lemma mul_right‚ÇÄ_symm_apply (c : Œ±) (hc : c ‚â† 0) :
  ((homeomorph.mul_right‚ÇÄ c hc).symm : Œ± ‚Üí Œ±) = Œª x, x * c‚Åª¬π := rfl
end homeomorph
section zpow
variables [group_with_zero G‚ÇÄ] [topological_space G‚ÇÄ] [has_continuous_inv‚ÇÄ G‚ÇÄ]
  [has_continuous_mul G‚ÇÄ]
lemma continuous_at_zpow‚ÇÄ (x : G‚ÇÄ) (m : ‚Ñ§) (h : x ‚â† 0 ‚à® 0 ‚â§ m) : continuous_at (Œª x, x ^ m) x :=
begin
  cases m,
  { simpa only [zpow_of_nat] using continuous_at_pow x m },
  { simp only [zpow_neg_succ_of_nat],
    have hx : x ‚â† 0, from h.resolve_right (int.neg_succ_of_nat_lt_zero m).not_le,
    exact (continuous_at_pow x (m + 1)).inv‚ÇÄ (pow_ne_zero _ hx) }
end
lemma continuous_on_zpow‚ÇÄ (m : ‚Ñ§) : continuous_on (Œª x : G‚ÇÄ, x ^ m) {0}·∂ú :=
Œª x hx, (continuous_at_zpow‚ÇÄ _ _ (or.inl hx)).continuous_within_at
lemma filter.tendsto.zpow‚ÇÄ {f : Œ± ‚Üí G‚ÇÄ} {l : filter Œ±} {a : G‚ÇÄ} (hf : tendsto f l (ùìù a)) (m : ‚Ñ§)
  (h : a ‚â† 0 ‚à® 0 ‚â§ m) :
  tendsto (Œª x, (f x) ^ m) l (ùìù (a ^ m)) :=
(continuous_at_zpow‚ÇÄ _ m h).tendsto.comp hf
variables {X : Type*} [topological_space X] {a : X} {s : set X} {f : X ‚Üí G‚ÇÄ}
lemma continuous_at.zpow‚ÇÄ (hf : continuous_at f a) (m : ‚Ñ§) (h : f a ‚â† 0 ‚à® 0 ‚â§ m) :
  continuous_at (Œª x, (f x) ^ m) a :=
hf.zpow‚ÇÄ m h
lemma continuous_within_at.zpow‚ÇÄ (hf : continuous_within_at f s a) (m : ‚Ñ§) (h : f a ‚â† 0 ‚à® 0 ‚â§ m) :
  continuous_within_at (Œª x, f x ^ m) s a :=
hf.zpow‚ÇÄ m h
lemma continuous_on.zpow‚ÇÄ (hf : continuous_on f s) (m : ‚Ñ§) (h : ‚àÄ a ‚àà s, f a ‚â† 0 ‚à® 0 ‚â§ m) :
  continuous_on (Œª x, f x ^ m) s :=
Œª a ha, (hf a ha).zpow‚ÇÄ m (h a ha)
@[continuity] lemma continuous.zpow‚ÇÄ (hf : continuous f) (m : ‚Ñ§) (h0 : ‚àÄ a, f a ‚â† 0 ‚à® 0 ‚â§ m) :
  continuous (Œª x, (f x) ^ m) :=
continuous_iff_continuous_at.2 $ Œª x, (hf.tendsto x).zpow‚ÇÄ m (h0 x)
end zpow
