import algebra.algebra.restrict_scalars
import data.complex.is_R_or_C
open is_R_or_C
variables {ğ•œ : Type*} [is_R_or_C ğ•œ] {F : Type*} [semi_normed_group F] [normed_space ğ•œ F]
local notation `absğ•œ` := @is_R_or_C.abs ğ•œ _
noncomputable def linear_map.extend_to_ğ•œ'
  [module â„ F] [is_scalar_tower â„ ğ•œ F] (fr : F â†’â‚—[â„] â„) : F â†’â‚—[ğ•œ] ğ•œ :=
begin
  let fc : F â†’ ğ•œ := Î» x, (fr x : ğ•œ) - (I : ğ•œ) * (fr ((I : ğ•œ) â€¢ x)),
  have add : âˆ€ x y : F, fc (x + y) = fc x + fc y,
  { assume x y,
    simp only [fc],
    simp only [smul_add, linear_map.map_add, of_real_add],
    rw mul_add,
    abel, },
  have A : âˆ€ (c : â„) (x : F), (fr ((c : ğ•œ) â€¢ x) : ğ•œ) = (c : ğ•œ) * (fr x : ğ•œ),
  { assume c x,
    rw [â† of_real_mul],
    congr' 1,
    rw [is_R_or_C.of_real_alg, smul_assoc, fr.map_smul, algebra.id.smul_eq_mul, one_smul] },
  have smul_â„ : âˆ€ (c : â„) (x : F), fc ((c : ğ•œ) â€¢ x) = (c : ğ•œ) * fc x,
  { assume c x,
    simp only [fc, A],
    rw A c x,
    rw [smul_smul, mul_comm I (c : ğ•œ), â† smul_smul, A, mul_sub],
    ring },
  have smul_I : âˆ€ x : F, fc ((I : ğ•œ) â€¢ x) = (I : ğ•œ) * fc x,
  { assume x,
    simp only [fc],
    cases @I_mul_I_ax ğ•œ _ with h h, { simp [h] },
    rw [mul_sub, â† mul_assoc, smul_smul, h],
    simp only [neg_mul, linear_map.map_neg, one_mul, one_smul,
      mul_neg, of_real_neg, neg_smul, sub_neg_eq_add, add_comm] },
  have smul_ğ•œ : âˆ€ (c : ğ•œ) (x : F), fc (c â€¢ x) = c â€¢ fc x,
  { assume c x,
    rw [â† re_add_im c, add_smul, add_smul, add, smul_â„, â† smul_smul, smul_â„, smul_I, â† mul_assoc],
    refl },
  exact { to_fun := fc, map_add' := add, map_smul' := smul_ğ•œ }
end
lemma linear_map.extend_to_ğ•œ'_apply [module â„ F] [is_scalar_tower â„ ğ•œ F]
  (fr : F â†’â‚—[â„] â„) (x : F) :
  fr.extend_to_ğ•œ' x = (fr x : ğ•œ) - (I : ğ•œ) * fr ((I : ğ•œ) â€¢ x) := rfl
lemma norm_bound [normed_space â„ F] [is_scalar_tower â„ ğ•œ F] (fr : F â†’L[â„] â„) (x : F) :
  âˆ¥(fr.to_linear_map.extend_to_ğ•œ' x : ğ•œ)âˆ¥ â‰¤ âˆ¥frâˆ¥ * âˆ¥xâˆ¥ :=
begin
  let lm : F â†’â‚—[ğ•œ] ğ•œ := fr.to_linear_map.extend_to_ğ•œ',
noncomputable def continuous_linear_map.extend_to_ğ•œ' [normed_space â„ F] [is_scalar_tower â„ ğ•œ F]
  (fr : F â†’L[â„] â„) :
  F â†’L[ğ•œ] ğ•œ :=
linear_map.mk_continuous _ (âˆ¥frâˆ¥) (norm_bound _)
lemma continuous_linear_map.extend_to_ğ•œ'_apply [normed_space â„ F] [is_scalar_tower â„ ğ•œ F]
  (fr : F â†’L[â„] â„) (x : F) :
  fr.extend_to_ğ•œ' x = (fr x : ğ•œ) - (I : ğ•œ) * fr ((I : ğ•œ) â€¢ x) := rfl
noncomputable def linear_map.extend_to_ğ•œ (fr : (restrict_scalars â„ ğ•œ F) â†’â‚—[â„] â„) : F â†’â‚—[ğ•œ] ğ•œ :=
fr.extend_to_ğ•œ'
lemma linear_map.extend_to_ğ•œ_apply (fr : (restrict_scalars â„ ğ•œ F) â†’â‚—[â„] â„) (x : F) :
  fr.extend_to_ğ•œ x = (fr x : ğ•œ) - (I : ğ•œ) * fr ((I : ğ•œ) â€¢ x : _) := rfl
noncomputable def continuous_linear_map.extend_to_ğ•œ (fr : (restrict_scalars â„ ğ•œ F) â†’L[â„] â„) :
  F â†’L[ğ•œ] ğ•œ :=
fr.extend_to_ğ•œ'
lemma continuous_linear_map.extend_to_ğ•œ_apply (fr : (restrict_scalars â„ ğ•œ F) â†’L[â„] â„) (x : F) :
  fr.extend_to_ğ•œ x = (fr x : ğ•œ) - (I : ğ•œ) * fr ((I : ğ•œ) â€¢ x : _) := rfl
