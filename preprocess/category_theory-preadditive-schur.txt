import algebra.group.ext
import category_theory.simple
import category_theory.linear
import category_theory.endomorphism
import algebra.algebra.spectrum
namespace category_theory
open category_theory.limits
variables {C : Type*} [category C]
variables [preadditive C]
lemma is_iso_of_hom_simple [has_kernels C] {X Y : C} [simple X] [simple Y] {f : X âŸ¶ Y} (w : f â‰  0) :
  is_iso f :=
begin
  haveI := mono_of_nonzero_from_simple w,
  exact is_iso_of_mono_of_nonzero w
end
lemma is_iso_iff_nonzero [has_kernels C] {X Y : C} [simple X] [simple Y] (f : X âŸ¶ Y) :
  is_iso f â†” f â‰  0 :=
âŸ¨Î» I,
  begin
    introI h,
    apply id_nonzero X,
    simp only [â†is_iso.hom_inv_id f, h, zero_comp],
  end,
  Î» w, is_iso_of_hom_simple wâŸ©
noncomputable
instance [has_kernels C] {X : C} [simple X] : division_ring (End X) :=
by classical; exact
{ inv := Î» f, if h : f = 0 then 0 else by { haveI := is_iso_of_hom_simple h, exact inv f, },
  exists_pair_ne := âŸ¨ğŸ™ X, 0, id_nonzero _âŸ©,
  inv_zero := dif_pos rfl,
  mul_inv_cancel := Î» f h, begin
    haveI := is_iso_of_hom_simple h,
    convert is_iso.inv_hom_id f,
    exact dif_neg h,
  end,
  ..(infer_instance : ring (End X)) }
open finite_dimensional
section
variables (ğ•œ : Type*) [division_ring ğ•œ]
lemma finrank_hom_simple_simple_eq_zero_of_not_iso
  [has_kernels C] [linear ğ•œ C] {X Y : C} [simple X] [simple Y]
  (h : (X â‰… Y) â†’ false):
  finrank ğ•œ (X âŸ¶ Y) = 0 :=
begin
  haveI := subsingleton_of_forall_eq (0 : X âŸ¶ Y) (Î» f, begin
    have p := not_congr (is_iso_iff_nonzero f),
    simp only [not_not, ne.def] at p,
    refine p.mp (Î» _, by exactI h (as_iso f)),
  end),
  exact finrank_zero_of_subsingleton,
end
end
variables (ğ•œ : Type*) [field ğ•œ]
variables [is_alg_closed ğ•œ] [linear ğ•œ C]
lemma finrank_endomorphism_simple_eq_one
  (X : C) [simple X] [I : finite_dimensional ğ•œ (X âŸ¶ X)] :
  finrank ğ•œ (X âŸ¶ X) = 1 :=
finrank_endomorphism_eq_one ğ•œ is_iso_iff_nonzero
lemma endomorphism_simple_eq_smul_id
  {X : C} [simple X] [I : finite_dimensional ğ•œ (X âŸ¶ X)] (f : X âŸ¶ X) :
  âˆƒ c : ğ•œ, c â€¢ ğŸ™ X = f :=
(finrank_eq_one_iff_of_nonzero' (ğŸ™ X) (id_nonzero X)).mp (finrank_endomorphism_simple_eq_one ğ•œ X) f
noncomputable
def field_End_of_finite_dimensional (X : C) [simple X] [I : finite_dimensional ğ•œ (X âŸ¶ X)] :
  field (End X) :=
by classical; exact
{ mul_comm := Î» f g, begin
    obtain âŸ¨c, rflâŸ© := endomorphism_simple_eq_smul_id ğ•œ f,
    obtain âŸ¨d, rflâŸ© := endomorphism_simple_eq_smul_id ğ•œ g,
    simp [â†mul_smul, mul_comm c d],
  end,
  ..(infer_instance : division_ring (End X)) }
